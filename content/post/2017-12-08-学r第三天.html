---
title: 学R第三天
author: 德宏
date: '2017-12-08'
slug: 学r第三天
isCJKLanguage: 
categories:
  - R
tags:
  - ggplot
---



<ul>
<li>参考《30分钟学会ggplot2》肖凯，基本概念</li>
</ul>
<!--more-->
<!-- toc -->
<div id="mpg" class="section level4">
<h4>1. 用mpg生成散点图</h4>
<pre class="r"><code>library(&quot;ggplot2&quot;) #载入ggplot2;</code></pre>
<pre><code>## Warning: 程辑包&#39;ggplot2&#39;是用R版本3.4.2 来建造的</code></pre>
<pre class="r"><code>str(mpg) #查看mpg数据集的变量类型</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    234 obs. of  11 variables:
##  $ manufacturer: chr  &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ...
##  $ model       : chr  &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; ...
##  $ displ       : num  1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
##  $ year        : int  1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
##  $ cyl         : int  4 4 4 4 6 6 6 4 4 4 ...
##  $ trans       : chr  &quot;auto(l5)&quot; &quot;manual(m5)&quot; &quot;manual(m6)&quot; &quot;auto(av)&quot; ...
##  $ drv         : chr  &quot;f&quot; &quot;f&quot; &quot;f&quot; &quot;f&quot; ...
##  $ cty         : int  18 21 20 21 16 18 18 18 16 20 ...
##  $ hwy         : int  29 29 31 30 26 26 27 26 25 28 ...
##  $ fl          : chr  &quot;p&quot; &quot;p&quot; &quot;p&quot; &quot;p&quot; ...
##  $ class       : chr  &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; ...</code></pre>
<pre class="r"><code>p&lt;-ggplot(mpg,mapping=aes(x=cty,y=hwy)) #以mpg为数据集，将变量cty(在城市中每加仑油跑的距离)，hwy(高速公路)mapping(映射)到x.y（aesthetics）轴上。
p+geom_point() #在图上加上几何对象：点（geometric piont）</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>p ;p+geom_point()#展示</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-1-2.png" width="672" /><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-1-3.png" width="672" /></p>
<pre class="r"><code>summary(p);summary(p+geom_point()) #查看对象的摘要描述</code></pre>
<pre><code>## data: manufacturer, model, displ, year, cyl, trans, drv, cty, hwy,
##   fl, class [234x11]
## mapping:  x = cty, y = hwy
## faceting: &lt;ggproto object: Class FacetNull, Facet&gt;
##     compute_layout: function
##     draw_back: function
##     draw_front: function
##     draw_labels: function
##     draw_panels: function
##     finish_data: function
##     init_scales: function
##     map: function
##     map_data: function
##     params: list
##     render_back: function
##     render_front: function
##     render_panels: function
##     setup_data: function
##     setup_params: function
##     shrink: TRUE
##     train: function
##     train_positions: function
##     train_scales: function
##     vars: function
##     super:  &lt;ggproto object: Class FacetNull, Facet&gt;</code></pre>
<pre><code>## data: manufacturer, model, displ, year, cyl, trans, drv, cty, hwy,
##   fl, class [234x11]
## mapping:  x = cty, y = hwy
## faceting: &lt;ggproto object: Class FacetNull, Facet&gt;
##     compute_layout: function
##     draw_back: function
##     draw_front: function
##     draw_labels: function
##     draw_panels: function
##     finish_data: function
##     init_scales: function
##     map: function
##     map_data: function
##     params: list
##     render_back: function
##     render_front: function
##     render_panels: function
##     setup_data: function
##     setup_params: function
##     shrink: TRUE
##     train: function
##     train_positions: function
##     train_scales: function
##     vars: function
##     super:  &lt;ggproto object: Class FacetNull, Facet&gt;
## -----------------------------------
## geom_point: na.rm = FALSE
## stat_identity: na.rm = FALSE
## position_identity</code></pre>
</div>
<div class="section level4">
<h4>2.将年份映射到颜色属性上</h4>
<pre class="r"><code>p&lt;-ggplot(mpg,mapping = aes(x = cty,y = hwy,colour = factor(year)))
p+geom_point()</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-2-1.png" width="672" /> #### 3.添加平滑曲线</p>
<pre class="r"><code>p+geom_point()+stat_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>rm(p) #清楚变量p，将年份只映射到点的颜色属性上P pP
p &lt;- ggplot(mpg, aes(x=cty,y=hwy))
p + geom_point(aes(colour=factor(year)))+stat_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-3-2.png" width="672" /> #### 4.换种思路绘一遍</p>
<pre class="r"><code>d &lt;- ggplot() +
geom_point(data=mpg, aes(x=cty, y=hwy, colour=factor(year)))+
stat_smooth(data=mpg, aes(x=cty, y=hwy))
#必须明确data eg no:d&lt;-ggplot()+geom_point(mpg,aes(x=cty,y=hwy,colour=factor(year)))+stat_smooth(mpg,aes(x=cty,y=hwy))
# 原因：ggplot与geom_各自的data与mapping的位置不一致，eg yes:d&lt;-ggplot()+geom_point(aes(x=cty,y=hwy,colour=factor(year)),mpg)+stat_smooth(aes(x=cty,y=hwy),mpg)
print(d)#此时除了底层画布外，有两个图层，分别定义了geom和 stat。</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-4-1.png" width="672" /> #### 5.用标度（scale)来修改颜色取值</p>
<p>scale_color_manual说明：This allows you to specify you own set of mappings from levels in the data to aesthetic values.</p>
<pre class="r"><code>d+scale_color_manual(values = c(&quot;yellow&quot;,&quot;red&quot;))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-5-1.png" width="672" /> #### 6.将排量映射到散点的大小上</p>
<pre class="r"><code>d &lt;- ggplot() +
geom_point(data=mpg, aes(x=cty, y=hwy, colour=factor(year),size=displ),alpha=0.5,position = &quot;jitter&quot;)+
stat_smooth(data=mpg, aes(x=cty, y=hwy))
d+scale_color_manual(values = c(&quot;yellow&quot;,&quot;red&quot;))+coord_cartesian(xlim = c(15, 25),ylim=c(15,40)) #用坐标控制图形显示的范围</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-6-1.png" width="672" /> #### 7.用facet（分面）显示不同年份的数据</p>
<pre class="r"><code>d &lt;- ggplot() +
geom_point(data=mpg, aes(x=cty, y=hwy, colour=factor(year),size=displ),alpha=0.5,position = &quot;jitter&quot;)+
stat_smooth(data=mpg, aes(x=cty, y=hwy))
d+scale_color_manual(values = c(&quot;yellow&quot;,&quot;red&quot;))+coord_cartesian(xlim = c(15, 25),ylim=c(15,40))+facet_wrap(~year,nrow=2)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-7-1.png" width="672" /> #### 6.增加图名幵精细修改图例</p>
<pre class="r"><code>d &lt;- ggplot() +
geom_point(data=mpg, aes(x=cty, y=hwy, colour=factor(year),size=displ),alpha=0.5,position = &quot;jitter&quot;)+
stat_smooth(data=mpg, aes(x=cty, y=hwy))
d+scale_color_manual(values = c(&quot;yellow&quot;,&quot;red&quot;))+coord_cartesian(xlim = c(15, 25),ylim=c(15,40))+facet_wrap(~year,nrow=2)+
labs(y=&#39;每加仑高速公路行驶距离&#39;,x=&#39;每加仑城市公路行驶距离&#39;)+guides(size=guide_legend(title=&#39;排量&#39;),colour = guide_legend(title=&#39;车型&#39;,override.aes=list(size=5)))+ggtitle(&#39;汽车油耗与型号&#39;)#不知道怎么居中</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="/post/2017-12-08-学r第三天_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="ggplot2" class="section level3">
<h3>今天先到这儿，ggplot2似乎有些博大精深………………</h3>
</div>
